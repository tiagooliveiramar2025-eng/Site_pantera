<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fichas - Pantera</title>

  <style>
    body {
      background-color: #004aad;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
      padding: 20px;
    }

    h1 { margin-bottom: 20px; }

    .container {
      background: rgba(0, 0, 0, 0.25);
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      margin: auto;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 5px;
      background-color: #ffcc00;
      cursor: pointer;
      font-size: 16px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      border: none;
    }
  </style>
</head>

<body>
  <h1>Sistema de Fichas - Pantera</h1>

  <div class="container">
    <input id="nome" type="text" placeholder="Nome da Ficha">
    <button onclick="adicionarFicha()">Adicionar Ficha</button>

    <input id="buscar" type="text" placeholder="Buscar Ficha">
    <button onclick="buscarFicha()">Buscar</button>

    <button onclick="apagarFicha()">Apagar Ficha</button>
    <button onclick="adicionarHoras()">Adicionar Horas</button>

    <p id="resultado"></p>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, updateDoc, doc } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // CONFIG DO SEU FIREBASE
    const firebaseConfig = {
      apiKey: "AIzaSyD-gypZc5Efz-DoguGbJ9is-gYy2Dhr0rY",
      authDomain: "pantera-8e6d0.firebaseapp.com",
      projectId: "pantera-8e6d0",
      storageBucket: "pantera-8e6d0.appspot.com",
      messagingSenderId: "1000862780737",
      appId: "1:1000862780737:web:cc8f620386c7ef2267d809"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function formatTempo(minutos) {
      if (!minutos) return "0h 0m";
      const h = Math.floor(minutos / 60);
      const m = minutos % 60;
      return `${h}h ${m}m`;
    }

    async function adicionarFicha() {
      const nome = document.getElementById("nome").value.trim();
      if (nome === "") return alert("Digite um nome!");

      await addDoc(collection(db, "fichas"), {
        nome: nome.toLowerCase(),
        totalMinutos: 0
      });

      alert("Ficha adicionada!");
      document.getElementById("nome").value = "";
    }

    async function buscarFicha() {
      const nomeBusca = document.getElementById("buscar").value.trim().toLowerCase();
      if (nomeBusca === "") return alert("Digite um nome!");

      const snap = await getDocs(collection(db, "fichas"));
      let ficha = null;

      snap.forEach(docu => {
        if (docu.data().nome === nomeBusca) {
          ficha = { id: docu.id, ...docu.data() };
        }
      });

      if (!ficha) return alert("Ficha não encontrada!");

      document.getElementById("resultado").textContent =
        `Nome: ${ficha.nome} | Tempo: ${formatTempo(ficha.totalMinutos)}`;
    }

    async function apagarFicha() {
      const nomeBusca = document.getElementById("buscar").value.trim().toLowerCase();
      if (!nomeBusca) return alert("Digite um nome!");

      const snap = await getDocs(collection(db, "fichas"));
      let ficha = null;

      snap.forEach(docu => {
        if (docu.data().nome === nomeBusca) {
          ficha = { id: docu.id };
        }
      });

      if (!ficha) return alert("Ficha não encontrada!");

      await deleteDoc(doc(db, "fichas", ficha.id));
      alert("Ficha apagada!");
      document.getElementById("resultado").textContent = "";
    }

    async function adicionarHoras() {
      const nomeBusca = document.getElementById("buscar").value.trim().toLowerCase();
      if (!nomeBusca) return alert("Digite um nome!");

      const snap = await getDocs(collection(db, "fichas"));
      let ficha = null;

      snap.forEach(docu => {
        if (docu.data().nome === nomeBusca) {
          ficha = { id: docu.id, ...docu.data() };
        }
      });

      if (!ficha) return alert("Ficha não encontrada!");

      let minutos = prompt("Quantos minutos deseja adicionar?");
      minutos = Number(minutos);

      if (isNaN(minutos) || minutos <= 0) return alert("Valor inválido!");

      await updateDoc(doc(db, "fichas", ficha.id), {
        totalMinutos: ficha.totalMinutos + minutos
      });

      alert("Horas adicionadas!");
    }
  </script>
</body>
</html>
